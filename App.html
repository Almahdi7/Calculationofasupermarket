<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tango Calc - نظام إدارة فواتير الميني ماركت</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #3498db;
        --secondary: #2c3e50;
        --accent: #e74c3c;
        --light: #ecf0f1;
        --dark: #2c3e50;
        --success: #2ecc71;
        --warning: #f39c12;
        --invoice: #9b59b6;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
        color: #333;
        min-height: 100vh;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .container {
        background: white;
        width: 100%;
        max-width: 1000px;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .header {
        background: var(--secondary);
        color: white;
        padding: 20px;
        text-align: center;
        position: relative;
      }

      .header h1 {
        font-size: 28px;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .header h1 .logo {
        font-weight: bold;
        color: var(--primary);
        background: white;
        padding: 5px 10px;
        border-radius: 8px;
      }

      .tabs {
        display: flex;
        background: #f8f9fa;
        border-bottom: 2px solid #ddd;
        flex-wrap: wrap;
      }

      .tab {
        padding: 15px 20px;
        text-align: center;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s;
        flex: 1;
        min-width: 120px;
      }

      .tab.active {
        background: var(--primary);
        color: white;
      }

      .tab.invoice-tab.active {
        background: var(--invoice);
      }

      .tab-content {
        display: none;
        padding: 20px;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.5s;
      }

      .input-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: var(--dark);
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      input:focus,
      select:focus,
      textarea:focus {
        border-color: var(--primary);
        outline: none;
      }

      button {
        background: var(--primary);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        width: 100%;
        margin-top: 10px;
        font-weight: bold;
        transition: background 0.3s;
      }

      button:hover {
        background: #2980b9;
      }

      .btn-invoice {
        background: var(--invoice);
      }

      .btn-invoice:hover {
        background: #8e44ad;
      }

      .result {
        margin-top: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 8px;
        display: none;
        border-left: 5px solid var(--success);
      }

      .result.show {
        display: block;
        animation: fadeIn 0.5s;
      }

      .result h3 {
        color: var(--dark);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .result p {
        margin: 8px 0;
        display: flex;
        justify-content: space-between;
      }

      .result .value {
        font-weight: bold;
        color: var(--secondary);
      }

      .history {
        margin-top: 30px;
      }

      .history h3 {
        color: var(--dark);
        margin-bottom: 10px;
        padding-bottom: 5px;
        border-bottom: 2px solid var(--primary);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      th,
      td {
        padding: 10px;
        text-align: center;
        border-bottom: 1px solid #ddd;
      }

      th {
        background-color: #f2f2f2;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @media (max-width: 768px) {
        .container {
          margin: 10px;
        }

        .header h1 {
          font-size: 20px;
        }

        .tabs {
          flex-direction: column;
        }
      }

      .currency {
        color: var(--accent);
        font-weight: bold;
      }

      .per-piece {
        background-color: #fff4e6;
        border-left: 5px solid var(--warning);
      }

      .per-piece h3 {
        color: var(--warning);
      }

      .instructions {
        background-color: #e8f4fc;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 5px solid var(--primary);
      }

      .instructions h3 {
        color: var(--primary);
        margin-bottom: 10px;
      }

      .instructions ul {
        padding-right: 20px;
      }

      .instructions li {
        margin-bottom: 8px;
      }

      .invoice-form {
        background-color: #f5eef8;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 5px solid var(--invoice);
      }

      .invoice-form h3 {
        color: var(--invoice);
        margin-bottom: 15px;
      }

      .invoice-item {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        flex-wrap: wrap;
      }

      .invoice-item input {
        flex: 1;
        min-width: 120px;
      }

      .invoice-items-list {
        margin: 20px 0;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
      }

      .invoice-items-list table {
        margin: 0;
      }

      .invoice-items-list th {
        background-color: var(--invoice);
        color: white;
      }

      .invoice-summary {
        background-color: #eafaf1;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        border-left: 5px solid var(--success);
      }

      .invoice-summary h3 {
        color: var(--success);
        margin-bottom: 10px;
      }

      .saved-invoices {
        margin-top: 30px;
      }

      .invoice-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        border-left: 5px solid var(--invoice);
      }

      .invoice-card h4 {
        color: var(--invoice);
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
      }

      .invoice-card p {
        margin: 5px 0;
      }

      .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .action-buttons button {
        flex: 1;
        padding: 8px;
        font-size: 14px;
      }

      .delete-btn {
        background: var(--accent);
      }

      .delete-btn:hover {
        background: #c0392b;
      }

      .no-invoices {
        text-align: center;
        padding: 20px;
        color: #7f8c8d;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><span class="logo">TANGO</span> CALC</h1>
        <p>حساب أرباح الميني ماركت بالليرة السورية</p>
      </div>

      <div class="tabs">
        <div class="tab active" onclick="switchTab('total')">
          حساب الربح الإجمالي
        </div>
        <div class="tab" onclick="switchTab('piece')">حساب ربح القطعة</div>
        <div class="tab invoice-tab" onclick="switchTab('invoice')">
          إدارة الفواتير
        </div>
      </div>

      <!-- قسم حساب الربح الإجمالي -->
      <div id="totalTab" class="tab-content active">
        <div class="instructions">
          <h3><i class="fas fa-info-circle"></i> كيفية الاستخدام</h3>
          <ul>
            <li>أدخل تكلفة شراء المنتج (سعر الشراء الإجمالي)</li>
            <li>أدخل سعر بيع المنتج (سعر البيع الإجمالي)</li>
            <li>حدد الكمية المباعة</li>
            <li>أضف المصاريف الإضافية إذا وجدت (اختياري)</li>
            <li>انقر على زر "احسب الربح"</li>
          </ul>
        </div>

        <div class="input-group">
          <label for="cost">تكلفة الشراء (ليرة سورية)</label>
          <input type="number" id="cost" placeholder="أدخل تكلفة المنتج" />
        </div>

        <div class="input-group">
          <label for="price">سعر البيع (ليرة سورية)</label>
          <input type="number" id="price" placeholder="أدخل سعر البيع" />
        </div>

        <div class="input-group">
          <label for="quantity">الكمية</label>
          <input
            type="number"
            id="quantity"
            placeholder="أدخل الكمية"
            value="1"
          />
        </div>

        <div class="input-group">
          <label for="expenses">المصاريف الإضافية (ليرة سورية) - اختياري</label>
          <input
            type="number"
            id="expenses"
            placeholder="أدخل المصاريف الإضافية"
            value="0"
          />
        </div>

        <button onclick="calculateProfit()">احسب الربح</button>

        <div id="result" class="result">
          <h3><i class="fas fa-calculator"></i> نتيجة الحساب:</h3>
          <p>
            إجمالي المبيعات: <span id="totalSales" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
          <p>
            إجمالي التكلفة: <span id="totalCost" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
          <p>
            المصاريف: <span id="totalExpenses" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
          <p>
            صافي الربح: <span id="netProfit" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
          <p>نسبة الربح: <span id="profitPercentage" class="value"></span>%</p>
        </div>

        <div class="history">
          <h3><i class="fas fa-history"></i> سجل الحسابات</h3>
          <table id="historyTable">
            <thead>
              <tr>
                <th>النوع</th>
                <th>التكلفة</th>
                <th>سعر البيع</th>
                <th>الربح</th>
              </tr>
            </thead>
            <tbody id="historyBody">
              <!-- سيتم إضافة السجلات هنا ديناميكيًا -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- قسم حساب ربح القطعة -->
      <div id="pieceTab" class="tab-content">
        <div class="instructions">
          <h3><i class="fas fa-info-circle"></i> كيفية حساب ربح القطعة</h3>
          <ul>
            <li>أدخل سعر شراء العلبة/العبوة كاملة</li>
            <li>أدخل سعر بيع العلبة/العبوة كاملة</li>
            <li>أدخل عدد القطع في العلبة/العبوة</li>
            <li>حدد عدد العلب/العبوات المباعة</li>
            <li>أضف المصاريف الإضافية إذا وجدت (اختياري)</li>
            <li>انقر على زر "احسب ربح القطعة"</li>
          </ul>
        </div>

        <div class="input-group">
          <label for="boxCost">سعر شراء العلبة (ليرة سورية)</label>
          <input
            type="number"
            id="boxCost"
            placeholder="أدخل سعر شراء العلبة"
          />
        </div>

        <div class="input-group">
          <label for="boxPrice">سعر بيع العلبة (ليرة سورية)</label>
          <input
            type="number"
            id="boxPrice"
            placeholder="أدخل سعر بيع العلبة"
          />
        </div>

        <div class="input-group">
          <label for="piecesInBox">عدد القطع في العلبة</label>
          <input
            type="number"
            id="piecesInBox"
            placeholder="أدخل عدد القطع في العلبة"
          />
        </div>

        <div class="input-group">
          <label for="boxQuantity">عدد العلب المباعة</label>
          <input
            type="number"
            id="boxQuantity"
            placeholder="أدخل عدد العلب المباعة"
            value="1"
          />
        </div>

        <div class="input-group">
          <label for="pieceExpenses"
            >المصاريف الإضافية (ليرة سورية) - اختياري</label
          >
          <input
            type="number"
            id="pieceExpenses"
            placeholder="أدخل المصاريف الإضافية"
            value="0"
          />
        </div>

        <button onclick="calculatePieceProfit()">احسب ربح القطعة</button>

        <div id="pieceResult" class="result">
          <h3><i class="fas fa-calculator"></i> نتيجة الحساب:</h3>
          <p>
            إجمالي المبيعات: <span id="totalBoxSales" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
          <p>
            إجمالي التكلفة: <span id="totalBoxCost" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
          <p>
            المصاريف: <span id="totalPieceExpenses" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
          <p>
            صافي الربح الإجمالي: <span id="netBoxProfit" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
          <p>
            نسبة الربح: <span id="boxProfitPercentage" class="value"></span>%
          </p>
        </div>

        <div id="perPieceResult" class="result per-piece">
          <h3><i class="fas fa-cube"></i> حساب ربح القطعة الواحدة:</h3>
          <p>
            سعر شراء القطعة: <span id="costPerPiece" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
          <p>
            سعر بيع القطعة: <span id="pricePerPiece" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
          <p>
            ربح القطعة: <span id="profitPerPiece" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
          <p>
            إجمالي ربح القطع:
            <span id="totalPiecesProfit" class="value"></span>
            <span class="currency">ل.س</span>
          </p>
        </div>

        <div class="history">
          <h3><i class="fas fa-history"></i> سجل الحسابات</h3>
          <table id="pieceHistoryTable">
            <thead>
              <tr>
                <th>النوع</th>
                <th>التكلفة</th>
                <th>سعر البيع</th>
                <th>الربح</th>
              </tr>
            </thead>
            <tbody id="pieceHistoryBody">
              <!-- سيتم إضافة السجلات هنا ديناميكيًا -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- قسم إدارة الفواتير -->
      <div id="invoiceTab" class="tab-content">
        <div class="instructions">
          <h3><i class="fas fa-info-circle"></i> نظام إدارة الفواتير</h3>
          <ul>
            <li>قم بإضافة المنتجات إلى الفاتورة الحالية</li>
            <li>حدد سعر الشراء وسعر البيع وكمية كل منتج</li>
            <li>سيتم حساب الربح تلقائياً لكل منتج وللفاتورة ككل</li>
            <li>احفظ الفاتورة لمراجعتها لاحقاً</li>
          </ul>
        </div>

        <div class="invoice-form">
          <h3><i class="fas fa-receipt"></i> فاتورة جديدة</h3>

          <div class="input-group">
            <label for="invoiceName">اسم الفاتورة (اختياري)</label>
            <input
              type="text"
              id="invoiceName"
              placeholder="أدخل اسمًا للفاتورة"
            />
          </div>

          <h4>إضافة منتج إلى الفاتورة:</h4>
          <div class="invoice-item">
            <input type="text" id="itemName" placeholder="اسم المنتج" />
            <input type="number" id="itemCost" placeholder="سعر الشراء (ل.س)" />
            <input type="number" id="itemPrice" placeholder="سعر البيع (ل.س)" />
            <input
              type="number"
              id="itemQuantity"
              placeholder="الكمية"
              value="1"
            />
            <button onclick="addItemToInvoice()" class="btn-invoice">
              <i class="fas fa-plus"></i> إضافة
            </button>
          </div>
        </div>

        <div id="currentInvoice">
          <h3>المنتجات المضافة:</h3>
          <div class="invoice-items-list">
            <table>
              <thead>
                <tr>
                  <th>اسم المنتج</th>
                  <th>سعر الشراء</th>
                  <th>سعر البيع</th>
                  <th>الكمية</th>
                  <th>الربح</th>
                  <th>إجراءات</th>
                </tr>
              </thead>
              <tbody id="invoiceItems">
                <!-- سيتم إضافة العناصر هنا -->
              </tbody>
            </table>
          </div>

          <div class="invoice-summary">
            <h3><i class="fas fa-calculator"></i> ملخص الفاتورة</h3>
            <p>
              إجمالي سعر الشراء: <span id="invoiceTotalCost">0</span>
              <span class="currency">ل.س</span>
            </p>
            <p>
              إجمالي سعر البيع: <span id="invoiceTotalPrice">0</span>
              <span class="currency">ل.س</span>
            </p>
            <p>
              إجمالي الربح: <span id="invoiceTotalProfit">0</span>
              <span class="currency">ل.س</span>
            </p>
            <button onclick="saveInvoice()" class="btn-invoice">
              <i class="fas fa-save"></i> حفظ الفاتورة
            </button>
          </div>
        </div>

        <div class="saved-invoices">
          <h3><i class="fas fa-history"></i> الفواتير المحفوظة</h3>
          <div id="invoicesList">
            <!-- سيتم عرض الفواتير المحفوظة هنا -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // بيانات التطبيق
      let currentInvoice = {
        name: "",
        items: [],
        totalCost: 0,
        totalPrice: 0,
        totalProfit: 0,
      };

      let savedInvoices =
        JSON.parse(localStorage.getItem("tangoInvoices")) || [];

      // دالة للتبديل بين علامات التبويب
      function switchTab(tabName) {
        // إخفاء جميع المحتويات
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });

        // إلغاء تنشيط جميع علامات التبويب
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.classList.remove("active");
        });

        // إظهار المحتوى المحدد
        document.getElementById(tabName + "Tab").classList.add("active");

        // تنشيط علامة التبويب المحددة
        document.querySelectorAll(".tab").forEach((tab) => {
          if (
            tab.textContent.includes(
              tabName === "total"
                ? "الإجمالي"
                : tabName === "piece"
                ? "القطعة"
                : "الفواتير"
            )
          ) {
            tab.classList.add("active");
          }
        });

        // إذا كانت علامة التبويب هي الفواتير، قم بتحميل الفواتير المحفوظة
        if (tabName === "invoice") {
          loadSavedInvoices();
        }
      }

      // دالة لحساب الربح الإجمالي
      function calculateProfit() {
        // الحصول على القيم من الحقول
        const cost = parseFloat(document.getElementById("cost").value);
        const price = parseFloat(document.getElementById("price").value);
        const quantity = parseInt(document.getElementById("quantity").value);
        const expenses =
          parseFloat(document.getElementById("expenses").value) || 0;

        // التحقق من صحة البيانات المدخلة
        if (
          isNaN(cost) ||
          isNaN(price) ||
          isNaN(quantity) ||
          cost <= 0 ||
          price <= 0 ||
          quantity <= 0
        ) {
          alert("يرجى إدخال قيم صحيحة في جميع الحقول");
          return;
        }

        // إجراء العمليات الحسابية
        const totalSales = price * quantity;
        const totalCost = cost * quantity;
        const netProfit = totalSales - totalCost - expenses;
        const profitPercentage = ((netProfit / totalCost) * 100).toFixed(2);

        // عرض النتائج
        document.getElementById("totalSales").textContent =
          totalSales.toLocaleString();
        document.getElementById("totalCost").textContent =
          totalCost.toLocaleString();
        document.getElementById("totalExpenses").textContent =
          expenses.toLocaleString();
        document.getElementById("netProfit").textContent =
          netProfit.toLocaleString();
        document.getElementById("profitPercentage").textContent =
          profitPercentage;

        // إظهار نتيجة الحساب
        document.getElementById("result").classList.add("show");

        // إضافة الحساب إلى سجل الحسابات
        addToHistory("إجمالي", cost, price, netProfit);
      }

      // دالة لحساب ربح القطعة
      function calculatePieceProfit() {
        // الحصول على القيم من الحقول
        const boxCost = parseFloat(document.getElementById("boxCost").value);
        const boxPrice = parseFloat(document.getElementById("boxPrice").value);
        const piecesInBox = parseInt(
          document.getElementById("piecesInBox").value
        );
        const boxQuantity = parseInt(
          document.getElementById("boxQuantity").value
        );
        const expenses =
          parseFloat(document.getElementById("pieceExpenses").value) || 0;

        // التحقق من صحة البيانات المدخلة
        if (
          isNaN(boxCost) ||
          isNaN(boxPrice) ||
          isNaN(piecesInBox) ||
          isNaN(boxQuantity) ||
          boxCost <= 0 ||
          boxPrice <= 0 ||
          piecesInBox <= 0 ||
          boxQuantity <= 0
        ) {
          alert("يرجى إدخال قيم صحيحة في جميع الحقول");
          return;
        }

        // إجراء العمليات الحسابية
        const totalSales = boxPrice * boxQuantity;
        const totalCost = boxCost * boxQuantity;
        const netProfit = totalSales - totalCost - expenses;
        const profitPercentage = ((netProfit / totalCost) * 100).toFixed(2);

        // حساب الربح للقطعة الواحدة
        const costPerPiece = boxCost / piecesInBox;
        const pricePerPiece = boxPrice / piecesInBox;
        const profitPerPiece = pricePerPiece - costPerPiece;
        const totalPiecesProfit = profitPerPiece * piecesInBox * boxQuantity;

        // عرض النتائج
        document.getElementById("totalBoxSales").textContent =
          totalSales.toLocaleString();
        document.getElementById("totalBoxCost").textContent =
          totalCost.toLocaleString();
        document.getElementById("totalPieceExpenses").textContent =
          expenses.toLocaleString();
        document.getElementById("netBoxProfit").textContent =
          netProfit.toLocaleString();
        document.getElementById("boxProfitPercentage").textContent =
          profitPercentage;

        document.getElementById("costPerPiece").textContent =
          costPerPiece.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          });
        document.getElementById("pricePerPiece").textContent =
          pricePerPiece.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          });
        document.getElementById("profitPerPiece").textContent =
          profitPerPiece.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          });
        document.getElementById("totalPiecesProfit").textContent =
          totalPiecesProfit.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          });

        // إظهار نتيجة الحساب
        document.getElementById("pieceResult").classList.add("show");
        document.getElementById("perPieceResult").classList.add("show");

        // إضافة الحساب إلى سجل الحسابات
        addToPieceHistory("قطعة", boxCost, boxPrice, netProfit);
      }

      // دالة لإضافة الحساب إلى السجل (للقسم الإجمالي)
      function addToHistory(type, cost, price, profit) {
        const historyBody = document.getElementById("historyBody");
        const newRow = document.createElement("tr");

        newRow.innerHTML = `
                <td>${type}</td>
                <td>${cost.toLocaleString()} ل.س</td>
                <td>${price.toLocaleString()} ل.س</td>
                <td>${profit.toLocaleString()} ل.س</td>
            `;

        historyBody.appendChild(newRow);
      }

      // دالة لإضافة الحساب إلى السجل (لقسم القطعة)
      function addToPieceHistory(type, cost, price, profit) {
        const historyBody = document.getElementById("pieceHistoryBody");
        const newRow = document.createElement("tr");

        newRow.innerHTML = `
                <td>${type}</td>
                <td>${cost.toLocaleString()} ل.س</td>
                <td>${price.toLocaleString()} ل.س</td>
                <td>${profit.toLocaleString()} ل.س</td>
            `;

        historyBody.appendChild(newRow);
      }

      // دالة لإضافة منتج إلى الفاتورة
      function addItemToInvoice() {
        const name = document.getElementById("itemName").value;
        const cost = parseFloat(document.getElementById("itemCost").value);
        const price = parseFloat(document.getElementById("itemPrice").value);
        const quantity = parseInt(
          document.getElementById("itemQuantity").value
        );

        if (
          !name ||
          isNaN(cost) ||
          isNaN(price) ||
          isNaN(quantity) ||
          cost <= 0 ||
          price <= 0 ||
          quantity <= 0
        ) {
          alert("يرجى ملء جميع الحقول بشكل صحيح");
          return;
        }

        const profit = (price - cost) * quantity;

        // إضافة المنتج إلى الفاتورة الحالية
        currentInvoice.items.push({
          name,
          cost,
          price,
          quantity,
          profit,
        });

        // تحديث الإجماليات
        currentInvoice.totalCost += cost * quantity;
        currentInvoice.totalPrice += price * quantity;
        currentInvoice.totalProfit += profit;

        // تحديث واجهة المستخدم
        updateInvoiceUI();

        // مسح الحقول
        document.getElementById("itemName").value = "";
        document.getElementById("itemCost").value = "";
        document.getElementById("itemPrice").value = "";
        document.getElementById("itemQuantity").value = "1";
      }

      // دالة لتحديث واجهة الفاتورة
      function updateInvoiceUI() {
        const invoiceItems = document.getElementById("invoiceItems");
        invoiceItems.innerHTML = "";

        // إضافة جميع العناصر إلى الجدول
        currentInvoice.items.forEach((item, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.cost.toLocaleString()} ل.س</td>
                    <td>${item.price.toLocaleString()} ل.س</td>
                    <td>${item.quantity}</td>
                    <td>${item.profit.toLocaleString()} ل.س</td>
                    <td>
                        <button class="delete-btn" onclick="removeItemFromInvoice(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
          invoiceItems.appendChild(row);
        });

        // تحديث الإجماليات
        document.getElementById("invoiceTotalCost").textContent =
          currentInvoice.totalCost.toLocaleString();
        document.getElementById("invoiceTotalPrice").textContent =
          currentInvoice.totalPrice.toLocaleString();
        document.getElementById("invoiceTotalProfit").textContent =
          currentInvoice.totalProfit.toLocaleString();
      }

      // دالة لإزالة منتج من الفاتورة
      function removeItemFromInvoice(index) {
        const item = currentInvoice.items[index];

        // تحديث الإجماليات
        currentInvoice.totalCost -= item.cost * item.quantity;
        currentInvoice.totalPrice -= item.price * item.quantity;
        currentInvoice.totalProfit -= item.profit;

        // إزالة العنصر من المصفوفة
        currentInvoice.items.splice(index, 1);

        // تحديث واجهة المستخدم
        updateInvoiceUI();
      }

      // دالة لحفظ الفاتورة
      function saveInvoice() {
        if (currentInvoice.items.length === 0) {
          alert("لا يمكن حفظ فاتورة فارغة");
          return;
        }

        // تعيين اسم الفاتورة إذا كان غير محدد
        const invoiceName = document.getElementById("invoiceName").value;
        currentInvoice.name =
          invoiceName || `فاتورة ${new Date().toLocaleDateString()}`;
        currentInvoice.date = new Date().toLocaleString();

        // إضافة الفاتورة الحالية إلى الفواتير المحفوظة
        savedInvoices.push({ ...currentInvoice });

        // حفظ في localStorage
        localStorage.setItem("tangoInvoices", JSON.stringify(savedInvoices));

        // إعادة تعيين الفاتورة الحالية
        resetInvoice();

        // تحديث واجهة المستخدم
        updateInvoiceUI();
        loadSavedInvoices();

        alert("تم حفظ الفاتورة بنجاح");
      }

      // دالة لإعادة تعيين الفاتورة الحالية
      function resetInvoice() {
        currentInvoice = {
          name: "",
          items: [],
          totalCost: 0,
          totalPrice: 0,
          totalProfit: 0,
        };

        document.getElementById("invoiceName").value = "";
      }

      // دالة لتحميل الفواتير المحفوظة
      function loadSavedInvoices() {
        const invoicesList = document.getElementById("invoicesList");

        if (savedInvoices.length === 0) {
          invoicesList.innerHTML = `
                    <div class="no-invoices">
                        <i class="fas fa-receipt" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>لا توجد فواتير محفوظة</p>
                    </div>
                `;
          return;
        }

        invoicesList.innerHTML = "";

        savedInvoices.forEach((invoice, index) => {
          const invoiceCard = document.createElement("div");
          invoiceCard.className = "invoice-card";
          invoiceCard.innerHTML = `
                    <h4>${invoice.name} <span>${invoice.date}</span></h4>
                    <p>عدد المنتجات: ${invoice.items.length}</p>
                    <p>إجمالي الشراء: ${invoice.totalCost.toLocaleString()} ل.س</p>
                    <p>إجمالي البيع: ${invoice.totalPrice.toLocaleString()} ل.س</p>
                    <p>صافي الربح: <strong>${invoice.totalProfit.toLocaleString()} ل.س</strong></p>
                    <div class="action-buttons">
                        <button onclick="viewInvoice(${index})"><i class="fas fa-eye"></i> عرض</button>
                        <button class="delete-btn" onclick="deleteInvoice(${index})"><i class="fas fa-trash"></i> حذف</button>
                    </div>
                `;
          invoicesList.appendChild(invoiceCard);
        });
      }

      // دالة لعرض تفاصيل الفاتورة
      function viewInvoice(index) {
        const invoice = savedInvoices[index];
        let itemsList = "";

        invoice.items.forEach((item) => {
          itemsList += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.cost.toLocaleString()} ل.س</td>
                        <td>${item.price.toLocaleString()} ل.س</td>
                        <td>${item.quantity}</td>
                        <td>${item.profit.toLocaleString()} ل.س</td>
                    </tr>
                `;
        });

        const invoiceDetails = `
                <h3>${invoice.name}</h3>
                <p>التاريخ: ${invoice.date}</p>
                <div class="invoice-items-list">
                    <table>
                        <thead>
                            <tr>
                                <th>اسم المنتج</th>
                                <th>سعر الشراء</th>
                                <th>سعر البيع</th>
                                <th>الكمية</th>
                                <th>الربح</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsList}
                        </tbody>
                    </table>
                </div>
                <div class="invoice-summary">
                    <p>إجمالي سعر الشراء: ${invoice.totalCost.toLocaleString()} ل.س</p>
                    <p>إجمالي سعر البيع: ${invoice.totalPrice.toLocaleString()} ل.س</p>
                    <p>إجمالي الربح: <strong>${invoice.totalProfit.toLocaleString()} ل.س</strong></p>
                </div>
            `;

        // إنشاء نافذة عرض بدلاً من alert لعرض المحتوى بطريقة أفضل
        const invoiceWindow = window.open(
          "",
          "Invoice Details",
          "width=800,height=600"
        );
        invoiceWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>تفاصيل الفاتورة</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
                        th, td { padding: 10px; text-align: center; border-bottom: 1px solid #ddd; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    ${invoiceDetails}
                </body>
                </html>
            `);
      }

      // دالة لحذف الفاتورة
      function deleteInvoice(index) {
        if (confirm("هل أنت متأكد من أنك تريد حذف هذه الفاتورة؟")) {
          savedInvoices.splice(index, 1);
          localStorage.setItem("tangoInvoices", JSON.stringify(savedInvoices));
          loadSavedInvoices();
        }
      }

      // تحميل الفواتير المحفوظة عند بدء التشغيل
      window.onload = function () {
        loadSavedInvoices();
      };
    </script>
  </body>
</html>
